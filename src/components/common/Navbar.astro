---
import { getLangFromUrl, useTranslations } from "../../i18n/utils";
import menuIcon from "../../assets/icons/menu-min.svg";
import { Image } from "astro:assets";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<nav
    class="sticky top-2 z-50 w-full backdrop-blur bg-[var(--color-surface)]/70 dark:bg-[var(--color-surface)]/70 shadow py-4"
>
    <div class="flex px-4 sm:px-8 md:px-12">
        <div
            class="hidden sm:flex items-center gap-8 text-sm sm:text-base xl:text-lg w-full"
        >
            <a href="#projects" class="hover:theme-hover theme-text font-medium"
                >{t("nav.projects")}</a
            >
            <a href="#about" class="hover:theme-hover theme-text font-medium"
                >{t("nav.about")}</a
            >
            <a
                href="#challenges"
                class="hover:theme-hover theme-text font-medium"
                >{t("nav.challenges")}</a
            >
        </div>

        <div class="flex justify-end w-full">
            <!-- BotÃ³n Tema + Selector Idioma -->
            <div class="flex justify-end">
                <button
                    id="theme-toggle"
                    class="bg-[var(--color-surface)]/70 theme-text px-3 py-1.5 rounded-md hover:bg-[var(--color-hover)] transition"
                    aria-label="Toggle theme"
                >
                    ðŸŒ“
                </button>

                <select
                    onchange="location.href = this.value"
                    class="bg-[var(--color-surface)]/70 theme-text px-3 py-1.5 rounded-md hover:bg-[var(--color-hover)] transition cursor-pointer text-sm"
                    aria-label="Select language"
                >
                    <option value="/es/" selected={lang === "es"}
                        >ðŸ‡ªðŸ‡¸ EspaÃ±ol</option
                    >
                    <option value="/en/" selected={lang === "en"}
                        >ðŸ‡¬ðŸ‡§ English</option
                    >
                </select>
            </div>
            <!-- MenÃº hamburguesa en mÃ³viles -->

            <div class="w-full flex justify-end sm:hidden">
                <button
                    class="sm:hidden p-2"
                    onclick="document.getElementById('mobile-menu').classList.toggle('hidden')"
                >
                    <Image
                        src={menuIcon}
                        alt="Menu"
                        width={28}
                        height={28}
                        loading="lazy"
                        class="w-7 h-7"
                    />
                </button>
            </div>
        </div>
    </div>

    <!-- MenÃº desplegable mobile -->
    <div
        id="mobile-menu"
        class="hidden sm:hidden bg-[var(--color-surface)]/90 backdrop-blur px-4 pt-4 pb-6 text-center space-y-4 shadow-lg"
    >
        <a
            href="#projects"
            class="block hover:theme-hover theme-text font-medium"
            >{t("nav.projects")}</a
        >
        <a href="#about" class="block hover:theme-hover theme-text font-medium"
            >{t("nav.about")}</a
        >
        <a
            href="#challenges"
            class="block hover:theme-hover theme-text font-medium"
            >{t("nav.challenges")}</a
        >
    </div>
</nav>

<script is:inline>
    document.addEventListener("DOMContentLoaded", () => {
        const toggleBtn = document.getElementById("theme-toggle");
        toggleBtn?.addEventListener("click", async () => {
            const mod = await import("/src/scripts/theme.ts");
            mod.toggleTheme();
        });
    });
</script>
